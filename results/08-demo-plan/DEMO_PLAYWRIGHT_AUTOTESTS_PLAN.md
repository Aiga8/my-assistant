## Демо: как запускать автотесты Playwright + TypeScript (solo-rtm)

### Цель демо
- **Показать команде**: как запускать автотесты

### 1) Коротко о проекте

- `solo-rtm` — это frontend-репозиторий с UI-автотестами для DrillSpot, написанными на Playwright + TypeScript.
- **Что делает фреймворк Playwright**:
  - запускает **реальный браузер** (обычно Chromium)
  - открывает **URL DrillSpot**
  - взаимодействует с **UI** (страницы, вкладки, виджеты)
  - проверяет **состояние интерфейса** (assert’ы/ожидания)

### 2) Особенности проекта
- **Не рассчитано** на работу с **реальным backend** и **реальным SSO**.
- По архитектуре проекта предполагается, что:
  - **большинство API‑запросов** подменяются **моками**
  - **WebSocket‑соединения** проксируются и/или **мокируются**
  - **авторизация** обходится через **SSO bypass** (без ввода логина/пароля)
- **SSO bypass**: обход логина через **моки auth API** — приложение получает ответ “как будто пользователь уже залогинен”.

### 3) Где описано, как развернуть проект локально
- **Статья**: [e2e tests for QA](https://starsteer.atlassian.net/wiki/spaces/RTM/pages/5569085620/e2e+tests+for+QA)
- **Месседж команде**: “Там есть полный гайд по разворачиванию; сегодня я подробнее остановлюсь на разделе **4. Запуск тестов**.”

### 4) Что показать в папке `playwright/` (структура + 1–2 фразы)
- **`playwright.config.ts`**: основные настройки запуска тестов (отчёты, режим браузера, настройки для WebSocket).
- **`fixtures/`**: общая подготовка перед тестами (общие настройки и “подготовительные шаги”). Пример: можно заранее выставить нужные cookies/feature flags, чтобы тест стартовал в правильном состоянии.
- **`helpers/playwright/UIMockManager.ts`**: место, где настраивается подмена HTTP запросов. Если в логах видишь **UNMOCKED API REQUEST** — значит запрос не замокан.
- **`mock/`**: подмены ответов API + тестовые данные (json/csv), чтобы тесты не зависели от реального backend.
- **`pages/`**: “страницы” (Page Objects) — тут лежат действия и локаторы, чтобы тесты были проще. `RootPage` — стартовая страница, где включаются моки.
- **`tests/`**: сами браузерные тесты, разложены по темам/экранам (Routing, Tabs, Widgets, trajectory…).
- **`tests/ws-mock/`**: всё, что связано с моками WebSocket (локальный сервер и прокси). Поднимается автоматически при старте тестов.

### 5) Запуск тестов (фокус демо)
#### 5.1 Выбрать сервер (стенд), на котором запускать тесты
- Показать `playwright/configs/env.ts`: здесь указывается **сервер** (для примера — `presolo`).
- Показать команду отката изменений после демо: git restore playwright/configs/env.ts

#### 5.2 Открыть терминал и перейти в папку с тестами
- Перейти в папку `playwright/` (запускать тесты нужно оттуда): cd playwright

#### 5.3 Пример запуска одного теста (длинная команда: файл + grep + headed)
- npx playwright test tests/Routing/service-tab-routing.spec.ts -g "STR-001" --headed
- `--headed` = запуск с видимым браузером 
setup, execution, assertions, teardown

### 6) Как смотреть отчёт
#### 6.1 Через терминал (HTML отчёт)
- Запустить просмотр отчёта: npx playwright show-report reports/html
- Откроется страница с прогоном: что упало, на каком шаге, скриншоты/видео/trace (если есть).

#### 6.2 Локально (как файл)
- Открыть папку `playwright/`.
- Перейти в `reports/` → `html/`.
- Открыть файл `index.html` (двойной клик) — он откроется в браузере.
- Если нужно **сохранить отчёт**: скопировать `index.html` в другое место (следующий прогон перезапишет отчет).

### 7) Ещё команды запуска
#### 7.1 Пример запуска одного теста (короткая команда: только grep)
- npx playwright test --grep "STR-001"

#### 7.2 Пример запуска всех тестов одного файла
- npx playwright test tests/Routing/service-tab-routing.spec.ts

#### 7.3 Запуск всех тестов
- npx playwright test

#### 7.4 Остановка запущенных тестов
- В том же терминале нажать `Ctrl + C` — это остановит `npx playwright test`

### 8) Прогнать один тест несколько раз подряд
- Полезно, если тест “флакает” и нужно поймать нестабильность.
- Пример (3 прогона одного теста):
  - npx playwright test --grep "STR-002" --repeat-each 3

### 9) Режим “медленнее” для демо: `$env:HEADED_SLOW="1"`
- В PowerShell можно включить замедление, чтобы в **headed** режиме было проще наблюдать шаги теста.
- Пример:
  - $env:HEADED_SLOW="1"; npx playwright test --grep "STR-002"
- Выключить: $env:HEADED_SLOW=$null

### 10) Skip: где можно поставить и как
- **Пропустить один конкретный тест**: ставится внутри `test(...)` (в самом начале).

```ts
test('TL-023 ...', async ({ page }) => {
  test.skip(true, 'временно выключили на демо');
  // ...
});
```

- **Пропустить группу тестов**: ставится на уровне `test.describe(...)`.

```ts
test.describe.skip('Routing', () => {
  // все тесты внутри будут пропущены
});
```








