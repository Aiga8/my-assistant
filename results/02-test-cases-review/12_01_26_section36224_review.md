# Review: TestRail section 36224 — Permissions (Anti-Collision Settings)

Аналитика: [[DS] Anti Collision Settings /ACTUAL/ (DS-7517)](https://starsteer.atlassian.net/wiki/spaces/RTM/pages/3095265586/DS+Anti+Collision+Settings+ACTUAL+DS-7517)

Секция TestRail: `36224` (suite_id: `5`, project_id: `5`)

## Ключевые требования из аналитики (для сверки)
- **Права на редактирование AC Settings**: не через `isAdmin`; права определяются **по маске прав** на уровне **глобального проекта** (даже если открыт дочерний виртуальный).
- **В виртуальном проекте**: используется имя и настройки **родительского глобального проекта**.
- **UI формы**: модальное окно `Anti-Collision Settings`, под заголовком отображается **название глобального проекта**. Для read-only пользователей — сообщение о недостатке прав и блокировка редактирования.

---

### **Тест 391986** — "AC Settings form opened by user with Manager role in GLOBAL project and Viewer role in VIRTUAL project"
- ✅ **Соответствие аналитике**: логика верная — роль в глобальном проекте должна определять возможность редактирования, даже если открыт виртуальный.
- ⚠️ **Техническая корректность / ожидаемый результат**:
  - В шаге открытия формы указано, что **Save активна** сразу. В аналитике явно описано, что кнопка применения/сохранения становится доступной при изменениях (см. FR5/FR10). Рекомендация: уточнить состояние `Save` **до изменений** (обычно disabled) и **после изменения** (enabled).
  - В Expected стоит “активные кнопка Save и Cancel”. В других кейсах для read-only состояния используется `Close`. Рекомендация: привести к одному словарю и UI-терминам (что реально в продукте: `Cancel` vs `Close`).
- ⚠️ **Структура**:
  - Шаг 2: “Изменить любой параметр…” → Expected про активность Save дублирует потенциально то, что должно быть в шаге 1 (см. пункт выше). Лучше: шаг 1 — проверка открытия и read/write статуса, шаг 2 — изменение → Save становится enabled.

### **Тест 391987** — "AC Settings form opened by user with Viewer role in GLOBAL project and Manager role in VIRTUAL project"
- ✅ **Соответствие аналитике**: логика верная — роль в виртуальном не должна давать права редактирования, если в глобальном `Viewer`.
- ❌ **Критичная проблема (качество текста / поддерживаемость)**:
  - Expected содержит огромный HTML/inline-styles (очевидный копипаст из редактора). Это сильно ухудшает читаемость и сопровождение кейса.
  - Рекомендация: почистить Expected до простого текста/маркированных списков.
- ⚠️ **Консистентность терминов**:
  - В read-only ожидается кнопка `Close`, а в 391986 — `Cancel`. Уточнить реальные названия кнопок и унифицировать по всем permission-тестам.
- ⚠️ **Уточнение проверки**:
  - Помимо “поля заблокированы”, полезно явно проверить: **нет возможности сохранить** (Save отсутствует или disabled), и попытки ввода/изменения не меняют значение.

### **Тест 391988** — "AC Settings form opened by user with \"No Access\" role in GLOBAL project and Manager role in VIRTUAL project"
- ✅ **Соответствие аналитике**: логика верная — при `NO ACCESS` в глобальном проекте функциональность недоступна в дочерних виртуальных (пункт меню скрыт).
- ⚠️ **Терминология**:
  - В аналитике роль написана как **NO ACCESS** (uppercase). В кейсе — `No Access`. Рекомендация: унифицировать написание (лучше как в продукте/аналитике).
- ➕ **Улучшение покрытия**:
  - Можно добавить явную проверку, что в меню настроек остаются другие пункты (если так задумано), но **AC Settings** отсутствует.

### **Тест 391989** — "Changing AC settings in GLOBAL project affects settings in its VIRTUAL projects"
- ✅ **Соответствие аналитике**: хороший smoke на наследование настроек виртуальными проектами.
- ⚠️ **Техническая корректность / точность**:
  - В Expected после сохранения: “форма закрывается” + toast. Это ок, но в аналитике также есть поведение лоадера и недоступности кнопки Save во время сохранения (FR6/FR10). Рекомендация: если это важно для permission/regression — добавить проверки.
- ➕ **Улучшение стабильности**:
  - Шаг “изменить любой параметр” делает кейс менее воспроизводимым. Лучше выбрать **конкретный параметр** (например, `Confidence level for EoU evaluation`) и конкретное значение, затем проверить его в виртуальном.

### **Тест 391990** — "Changing AC settings in VIRTUAL project affects settings in GLOBAL and its VIRTUAL projects"
- ✅ **Соответствие аналитике**: логика верная — изменения, сделанные из виртуального, применяются к родительскому глобальному и всем его виртуальным.
- ⚠️ **Техническая корректность / уточнение**:
  - Аналогично 391989: “любой параметр” лучше заменить на конкретный, чтобы исключить случайные зависимости/валидации.
  - В шаге 3 есть опечатка: “форму..” → “форму.”
- ➕ **Улучшение проверки прав**:
  - В Preconditions указано: в глобальном проекте у пользователя роль Manager/PI/Interpreter, а “в дочерних виртуальных любая роль”. Это ок, но кейс именно про редактирование из виртуального — стоит явно подтвердить, что в виртуальном пользователю доступен edit (из-за прав в глобальном), а не из-за собственной роли в виртуальном.

---

## Финальная сводка
- **Общее количество тестов**: 5
- **Тестов без замечаний**: 0
- **Тестов с проблемами**: 5
- **Критичные проблемы**: 1 (391987 — мусорный HTML в Expected)

## Общие рекомендации по секции
- **Унифицировать терминологию ролей**: `NO ACCESS` vs `No Access`, единообразие `Manager/Power Interpreter/Interpreter/GeoTech/Viewer`.
- **Унифицировать названия кнопок**: `Save/Cancel` vs `Close` — привести к фактическому UI.
- **Уточнить логику `Save`**: описать состояние до/после изменений (в аналитике это важно).
- **Убрать “любой параметр”** в тестах на наследование: выбрать 1–2 конкретных параметра и фиксированные значения.



