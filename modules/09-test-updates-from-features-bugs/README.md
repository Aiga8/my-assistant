# Инструкция для Cursor: Обновление тестов TestRail на основе новых фич или багов

## Быстрый старт (копипаст)

```
Открой и строго следуй инструкциям: modules/09-test-updates-from-features-bugs/README.md

Подготовь план обновления тестов в связи с задачей <JIRA_KEY> (фича/баг).
TestRail: проект <PROJECT_ID>, секция <SECTION_ID> (или несколько секций).
(Опционально) Дополнительный контекст: <payload API, формат данных, ссылки>.
```

---

## 0. Цель модуля

По задаче из Jira (новая фича или исправление бага) определить, **как и какие тест-кейсы** в указанной секции (или секциях) TestRail нужно обновить: правки описания секции, правки шагов/ожиданий в существующих кейсах, новые кейсы, обратная совместимость. Результат — структурированный документ-план для внесения изменений в TestRail.

---

## 1. Алгоритм работы

### Шаг 1 — Изучить задачу в Jira

- Открыть задачу по ключу (например, DS-10230) через MCP Jira.
- Прочитать **description**, **комментарии** (включая от разработки и QA).
- Выписать: что изменилось в продукте (форматы, API, поведение), требования к обратной совместимости, связанные баги/подзадачи.
- Если пользователь дал контекст (payload, формат запросов) — использовать его при формулировании ожиданий в тестах.

### Шаг 2 — Получить данные из TestRail

- По указанному **project_id** и **section_id** (или списку секций) получить:
  - описание секции (`get_section`);
  - все тест-кейсы секции (`get_cases`).
- При необходимости обойти дочерние секции и собрать кейсы по ним.

### Шаг 3 — Сопоставить изменения по задаче с тестами

- По описанию секции: устарели ли URL, названия полей, формат настроек (например, drillspot-settings)? Нужно ли обновить описание секции.
- По каждому кейсу: затрагивает ли изменение задачи шаги или ожидаемые результаты (URL, сохранение состояния, переключение проектов, форматы данных и т.д.)?
- Выявить кейсы, которые нужно **обновить** (правка шагов/ожиданий), и сценарии, для которых нужны **новые кейсы** (например, сохранение/восстановление вкладки, обратная совместимость).
- Учесть связанные баги из задачи: при необходимости добавить в ожидания явные проверки (например, «нет infinite loader»).

### Шаг 4 — Сформировать документ-план

Структура документа:

1. **Контекст** — ссылка на Jira, суть изменений (кратко).
2. **Что изменилось по задаче** — буллеты: форматы, API, поведение, совместимость.
3. **Формат данных / API (если релевантно)** — актуальный пример payload или структуры (по задаче или от пользователя).
4. **Обновление описания секции** — что сейчас в описании, что рекомендовано изменить.
5. **Какие тесты обновить и как** — по группам (URL/адресная строка; сохранение настроек; переключение проектов; обратная совместимость; остальные). Таблица: Case ID, название, что сделать.
6. **Новые тесты (рекомендации)** — идеи для новых кейсов с названием, предусловиями, шагами, ожиданием.
7. **Сводка действий** — таблица: действие → где (секция/кейс/новый кейс).

Не упоминать фич-флаги, если пользователь указал, что они сняты и правки работают без флага.

### Шаг 5 — Сохранить результат

Сохранить документ в:

`results/09-test-updates-from-features-bugs/`

Формат имени файла:

`dd_mm_yy_<JIRA_KEY>_section_<SECTION_ID>_updates.md`

или при нескольких секциях:

`dd_mm_yy_<JIRA_KEY>_sections_<краткое_описание>_updates.md`

Пример: `11_02_26_DS-10230_section_22177_updates.md`

---

## 2. Инструменты

- **Jira:** `mcp_mcp-atlassian_jira_get_issue` с `comment_limit` для получения комментариев.
- **TestRail:** `mcp_testrail_get_section`, `mcp_testrail_get_cases` (project_id, section_id), при необходимости `mcp_testrail_get_sections` для обхода дерева.

---

## 3. Что не делать

- Не придумывать тест-кейсы без связи с задачей.
- Не упоминать удалённые фич-флаги как условие прохождения тестов.
- Не сохранять результат в другие папки (например, `08-demo-plan`); этот модуль имеет свою папку результатов.

---

## 4. Маршрутизация (для главного README)

- если команда про **обновление тестов TestRail на основе новой фичи или бага** (Jira-задача + секция/проект TestRail) → модуль `09-test-updates-from-features-bugs`
